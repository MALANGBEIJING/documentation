=================
故障位置
=================

.. |QCP| replace:: :abbr:`QCP (质量控制点)`
.. |QCPs| replace:: :abbr:`QCP (质量控制点)`

在 Odoo 中，*质量控制点* (QCP) 用于创建 *质量检查*，当产品包含在某些操作中时，这些检查会提示员工确认产品的质量。通过在 |QCP| 上设置一个或多个 *故障位置*，未通过质量检查的产品可以被发送到指定的位置。

.. important::
   *故障位置* 功能在 Odoo 17.0 版本中新增，并 **不** 出现在之前的任何版本中。要将 Odoo 数据库升级到更高版本，请参阅 :doc:`数据库升级 <../../../../administration/upgrade>` 文档。

配置
=====

要使用故障位置，必须在 *库存* 应用的设置中启用 *存储位置* 设置。此设置允许在仓库内创建子位置，包括故障位置。

要启用 *存储位置* 设置，请导航到 :menuselection:`库存应用 --> 配置 --> 设置`，并在 :guilabel:`仓库` 标题下勾选 :guilabel:`存储位置` 旁的复选框。然后，点击 :guilabel:`保存`。

.. image:: failure_locations/storage-locations-setting.png
   :align: center
   :alt: 库存应用设置页面上的存储位置设置。

.. important::
   故障位置在用于配置为 *可存储产品* 时最为有效。因为库存数量只会跟踪可存储产品，而 *可消耗产品* 的精确数量则不会被跟踪。

   仍然可以为可消耗产品创建质量检查，并且如果这些产品未通过检查，它们可以被发送到故障位置。然而，Odoo 不会跟踪存储在故障位置的可消耗产品的精确数量。

   要将产品配置为可存储产品，请导航到 :menuselection:`库存应用 --> 产品 --> 产品`，并选择一个产品。在 :guilabel:`产品类型` 字段中，确保在 :guilabel:`常规信息` 标签页的下拉菜单中选择了 :guilabel:`可存储产品`。

将故障位置添加到QCP
========================

要将故障位置添加到 |QCP|，导航到 :menuselection:`质量应用 --> 质量控制 --> 控制点`。从列表中选择一个现有的 |QCP|，或通过点击 :guilabel:`新建` 来创建一个新的。

.. note::
   以下说明仅详细介绍了向 |QCP| 添加故障位置所需的配置设置。有关 |QCPs| 及其配置时可用的所有选项的完整概述，请参阅 :doc:`质量控制点 <quality_control_points>` 的文档。

在 |QCP| 表单的 :guilabel:`控制方式` 字段中，选择 :guilabel:`数量` 选项。这样会在表单上显示一个 :guilabel:`故障位置` 字段。此字段仅在选择 :guilabel:`数量` 选项时可用。

在 :guilabel:`故障位置` 字段中，从下拉菜单中选择一个或多个位置。要创建新位置，请在字段中输入所需的位置名称，然后从下拉菜单中选择 :guilabel:`创建 "[name]"`。

.. image:: failure_locations/qcp-form.png
   :align: center
   :alt: 在质量应用中配置有故障位置的 QCP 表单。

将产品发送到故障位置
==========================

一旦 |QCP| 配置了一个或多个故障位置，由 |QCP| 创建的质量检查中未通过检查的产品可以被发送到其中一个位置。

为此，打开一个需要质量检查的订单，该检查由配置了故障位置的 |QCP| 创建。例如，导航到 :menuselection:`库存应用 --> 操作 --> 收货`，并选择一个收货单。

在所选订单的顶部，点击 :guilabel:`质量检查` 按钮，打开一个弹出窗口，从中可以处理质量检查。在弹出窗口的底部，点击 :guilabel:`失败` 按钮，未通过质量检查，这会打开一个标题为 :guilabel:`[产品] 的质量检查失败` 的第二个弹出窗口。

在 :guilabel:`失败数量` 字段中，输入未通过质量检查的产品数量。在 :guilabel:`故障位置` 字段中，选择产品应发送到的故障位置。然后，点击弹出窗口底部的 :guilabel:`确认` 按钮关闭窗口。

.. image:: failure_locations/failed-pop-up.png
   :align: center
   :alt: 质量检查失败后出现的弹出窗口。

最后，在订单页面上点击顶部的 :guilabel:`验证` 按钮。这样可以确认未通过质量检查的产品被发送到故障位置，而通过检查的产品则被发送到它们的正常存储位置。

查看故障位置的库存
=======================

要查看存储在故障位置的产品数量，导航到 :menuselection:`库存应用 --> 配置 --> 位置`。从列表中选择一个故障位置。然后，点击该位置页面上的 :guilabel:`当前库存` 智能按钮。

故障位置页面会列出存储在该位置的所有产品及其数量。
