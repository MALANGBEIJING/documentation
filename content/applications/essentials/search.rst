=================================
搜索、过滤和分组记录
=================================

Odoo 允许用户在视图中搜索、过滤和分组记录，以显示最相关的记录。搜索栏位于视图的顶部，开始输入以 :ref:`搜索值 <search/values>`，或点击 :guilabel:`🔽 (向下箭头)` 图标以访问 :ref:`过滤器 <search/filters>`、:ref:`按组 <search/group>` 和 :ref:`收藏夹 <search/favorites>` 下拉菜单。

.. _search/values:

搜索值
=================

使用搜索字段快速查找特定值，并将其作为过滤器添加。输入要搜索的值，并从下拉菜单中选择所需的选项来应用搜索过滤器。

.. example::
   例如，在 *销售分析* 报告 (:menuselection:`销售应用程序 --> 报告 --> 销售`) 中，搜索 `Mitch`，点击 :guilabel:`⏵ (右箭头)` 旁边的 :guilabel:`搜索销售员：Mitch`，然后选择 :guilabel:`Mitchell Admin`，而不是添加 :ref:`自定义过滤器 <search/custom-filters>` 来选择销售员为 *Mitchell Admin* 的记录。

   .. image:: search/search-values.png
      :align: center
      :alt: 在销售分析报告中搜索特定值

.. note::
   使用搜索字段相当于使用 *包含* 操作符添加 :ref:`自定义过滤器 <search/custom-filters>`。如果输入了部分值，并且直接选择了所需字段（而不是选择 :guilabel:`⏵ (右箭头)`），则将包含所有选定字段中键入字符的记录。

.. _search/filters:

过滤器
=======

过滤器用于选择符合特定条件的记录。默认的记录选择特定于每个视图，但可以通过选择一个或多个 :ref:`预配置过滤器 <search/preconfigured-filters>` 或添加 :ref:`自定义过滤器 <search/custom-filters>` 来修改。

.. _search/preconfigured-filters:

预配置过滤器
---------------------

点击搜索栏中的 :guilabel:`🔽 (向下箭头)` 图标，从 :guilabel:`过滤器` 下拉菜单中选择一个或多个 *预配置过滤器* 来修改记录的默认选择。

.. example::
   在 *销售分析* 报告 (:menuselection:`销售应用程序 --> 报告 --> 销售`) 中，默认情况下，仅选择处于 *销售订单* 阶段、且 *订单日期* 在过去 365 天内的记录。

   若要同时包含处于 *报价* 阶段的记录，选择 :guilabel:`报价` 作为过滤器。

   此外，若要仅包含来自特定年份（例如 2024 年）的销售订单和报价记录，请先点击 :guilabel:`❌ (删除)` 图标删除现有的 `订单日期：最近 365 天` 过滤器，然后选择 :menuselection:`订单日期 --> 2024`。

   .. image:: search/preconfigured-filters.png
      :align: center
      :alt: 在销售分析报告中使用预配置过滤器

.. note::
   预配置的 :guilabel:`过滤器` 按组分组，每组由一条水平线分隔。从同一组选择预配置过滤器允许记录匹配应用条件中的任意一个。然而，选择来自不同组的过滤器要求记录匹配所有应用的条件。

.. _search/custom-filters:

自定义过滤器
--------------

如果 :ref:`预配置过滤器 <search/preconfigured-filters>` 不够具体，可以添加自定义过滤器。为此，请点击搜索栏中的 :guilabel:`🔽 (向下箭头)` 图标，然后选择 :menuselection:`过滤器 --> 添加自定义过滤器`。

:guilabel:`添加自定义过滤器` 弹出窗口显示匹配选项、过滤规则以及 :guilabel:`包含已归档` 记录的切换开关。

.. image:: search/custom-filter.png
   :align: center
   :alt: 添加自定义过滤器弹出窗口

默认的匹配配置是 :guilabel:`匹配以下任意规则`，表示每个过滤规则独立应用。若要将匹配配置更改为 :guilabel:`匹配以下所有规则`，则必须为自定义过滤器添加至少两个过滤规则。

- :guilabel:`匹配以下所有 🔽 规则`: **所有** 过滤规则都必须满足。逻辑上，这是 *与* (`&`) 操作。
- :guilabel:`匹配以下任意 🔽 规则`: **任意** 过滤规则都可以满足。逻辑上，这是 *或* (`|`) 操作。

默认情况下，自定义过滤器中添加一个过滤规则。以下描述了过滤规则的结构：

#. 第一个内联字段是要过滤的 *字段名称*。某些字段具有嵌套在另一个字段中的精细参数。这些字段旁边有 :guilabel:`> (箭头)` 图标，可以选择它以显示嵌套字段。
#. 第二个内联字段是用于将字段名称与值进行比较的条件 *操作符*。:ref:`可用的条件操作符 <reference/orm/domains>` 特定于字段的数据类型。
#. 第三个内联字段是字段名称的变量 *值*。根据操作符和字段的数据类型，值输入可能会显示为下拉菜单、文本输入框、数字输入框、日期/时间输入框、布尔选择器，或为空。

规则过滤条件右侧还提供了三个内联按钮：

#. :guilabel:`➕ (加号)`: 在现有规则下方添加新规则。
#. :guilabel:`(添加分支)`: 在现有规则下方添加新的规则组，并提供 :guilabel:`任意` 和 :guilabel:`所有` 匹配选项，以定义此分支中的每条规则如何应用于过滤器。如果匹配选项设置为与父组相同，则字段将移动并加入父组。

   .. example::
      如果匹配选项设置为 :guilabel:`匹配以下所有规则`，并添加了一个新分支，并将其匹配选项从 :guilabel:`任意 🔽` 更改为 :guilabel:`所有 🔽`，则新添加的分支将消失，并且其规则组将移到父组。

#. :guilabel:`🗑️ (垃圾桶)`: 删除节点。如果删除分支节点，则该节点的所有子节点也将被删除。

点击 :guilabel:`新规则` 按钮，可以为自定义过滤器添加新的过滤规则。

定义过滤条件后，点击 :guilabel:`添加` 将自定义过滤器添加到视图中。

.. example::
   要筛选 *CRM* 应用程序中处于 *已赢得* 阶段且预期收入超过 $1,000 的所有潜在客户和机会，应输入以下内容：

   :guilabel:`匹配以下所有 🔽 规则：`

   #. :guilabel:`阶段` :guilabel:`属于` :guilabel:`已赢得`
   #. :guilabel:`预期收入` :guilabel:`>` `1,000`
   #. :guilabel:`任意 🔽 规则：`

      - :guilabel:`类型` :guilabel:`=` :guilabel:`潜在客户`
      - :guilabel:`类型` :guilabel:`=` :guilabel:`机会`

   .. image:: search/custom-filter-example.png
      :align: center
      :alt: 在 CRM 中添加自定义过滤器以筛选特定记录

.. tip::
   启用 :ref:`开发者模式 <developer-mode>` 以显示每个字段的技术名称和数据类型，并在过滤规则下方显示 :guilabel:`# 代码编辑器` 文本区域，以手动查看和编辑域。

.. _search/group:

分组记录
=============

可以根据某个 *预配置组* 将视图中的记录聚集在一起。为此，请点击搜索栏中的 :guilabel:`🔽 (向下箭头)` 图标，然后从 :guilabel:`按组` 下拉菜单中选择一个选项。

.. example::
   要在 *销售分析* 报告 (:menuselection:`销售应用程序 --> 报告 --> 销售`) 中按销售员分组记录，请点击 :guilabel:`销售员` 选项。视图将更改为按销售员分组记录，而不会过滤掉任何记录。

   .. image:: search/group.png
      :align: center
      :alt: 在销售分析报告中分组记录

可以使用模型中存在的字段 *自定义分组*。为此，点击 :menuselection:`添加自定义组`，并从下拉菜单中选择一个字段。

.. note::
   可以同时使用多个组。选择的第一个组是主集群，添加的下一个组进一步划分主组的类别，依此类推。此外，过滤器和组可以结合使用，以进一步优化视图。

.. _search/comparison:

对比
==========
=====================
比较选项和收藏夹
=====================

某些报告仪表板包含 :guilabel:`比较` 部分，可以在其 :guilabel:`搜索...` 栏的下拉菜单中找到。这包括 *制造* 应用的 :doc:`整体设备效率 <../inventory_and_mrp/manufacturing/reporting/oee>` 报告，以及 *采购* 应用的 :doc:`采购报告 <../inventory_and_mrp/purchase/advanced/analyze>` 等其他报告。

:icon:`fa-adjust` :guilabel:`比较` 部分中的选项用于比较两个不同时间段的数据。可以选择两种比较选项：:guilabel:`(时间过滤器): 上一个时间段` 和 :guilabel:`(时间过滤器): 去年同期`。

.. important::
   对于某些报告，只有在 :guilabel:`过滤器` 列中选择了一个或多个时间段时，:guilabel:`比较` 部分才会出现在 :guilabel:`搜索...` 栏的下拉菜单中。这是因为，如果没有指定时间段，则没有可比较的内容。

   此外，一些报告只有在选择了 :icon:`fa-pie-chart` :guilabel:`(饼图)` 或 :icon:`oi-view-pivot` :guilabel:`(数据透视表)` 视图时，才允许使用 :guilabel:`比较` 功能。即使启用了其他视图，也可以选择 :guilabel:`比较` 选项，但这样做不会更改报告中数据的显示方式。

.. image:: search/comparison-section.png
   :align: center
   :alt: 生产分析报告的搜索栏。

要使用两种比较选项之一查看数据，首先在 :guilabel:`搜索...` 栏的下拉菜单的 :guilabel:`过滤器` 列中选择一个时间段。然后，在 :guilabel:`比较` 部分中，选择 :guilabel:`(时间过滤器): 上一个时间段` 或 :guilabel:`(时间过滤器): 去年同期`。

启用了其中一个 :guilabel:`比较` 选项后，报告会比较所选时间段的数据与上一时间段或上一年的同一时间单位（月、季度、年）的数据。数据显示的方式取决于所选视图：

- :icon:`fa-bar-chart` :guilabel:`(柱状图)` 为所选时间段的每个时间单位显示两个并排的柱状图。左侧柱状图代表所选时间段，右侧柱状图代表上一时间段。
- :icon:`fa-line-chart` :guilabel:`(折线图)` 显示两条线，一条代表所选时间段，另一条代表上一时间段。
- :icon:`fa-pie-chart` :guilabel:`(饼图)` 显示一个大圆圈和一个内嵌的小圆圈。大圆圈代表所选时间段，小圆圈代表上一时间段。
- :icon:`oi-view-pivot` :guilabel:`(数据透视表)` 将每一列分成两列。右侧列代表所选时间段，左侧列代表上一时间段。

.. example::
   在 *制造* 应用的 :guilabel:`生产分析` 报告中，将 2024 年第二季度的数据与 2023 年第二季度的数据进行比较。在 :guilabel:`搜索...` 栏的 :guilabel:`结束日期` 过滤器部分中选择 :guilabel:`Q2`，然后在 :guilabel:`比较` 部分中选择 :guilabel:`结束日期: 去年同期`。

   当前年份为 2024 年，因此较大的圆圈显示 2024 年第二季度 (Q2) 的数据。较小的圆圈显示 2023 年第二季度 (Q2) 的数据，即同一时间段，但在 *去年*。

   如果选择了 :guilabel:`结束日期: 上一个时间段`，则较小的圆圈显示 2024 年第一季度 (Q1) 的数据，即同一时间段，但在 *前一个时间段*。

   .. image:: search/comparison.png
      :align: center
      :alt: 生产分析报告的比较视图。

.. _search/favorites:

收藏夹
=========

收藏夹是一种保存特定搜索以供将来使用或作为视图的新默认过滤器的方式。

要将当前视图保存为收藏夹，点击搜索栏中的 :guilabel:`🔽 (向下箭头)` 图标，然后选择 :guilabel:`保存当前搜索` 下拉菜单以显示以下选项：

- 过滤器名称: 收藏搜索的名称。
- :guilabel:`默认过滤器`: 将收藏搜索设置为视图的默认过滤器。
- :guilabel:`共享`: 使收藏搜索对所有用户可用。默认情况下，收藏搜索仅对创建它的用户可用。

设置完选项后，点击 :guilabel:`保存` 以保存收藏搜索。

.. image:: search/favorites.png
   :align: center
   :alt: 在销售分析报告中保存收藏搜索

可以通过点击搜索栏中的 :guilabel:`🔽 (向下箭头)` 图标，然后在 :guilabel:`收藏夹` 下拉菜单中选择已保存的过滤器来访问已保存的收藏夹。要删除已保存的收藏夹，请点击收藏搜索旁边的 :guilabel:`🗑️ (垃圾桶)` 图标。

.. tip::
   若要查看 *所有* 收藏搜索，请先启用 :ref:`开发者模式 <developer-mode>`，然后导航到 :menuselection:`设置应用 --> 技术 --> 用户界面: 用户定义的过滤器`。在这里，可以查看、编辑、归档或删除所有收藏搜索。
